services:
  invoice-automation:
    build: .
    env_file: .env
    environment:
      # Force unbuffered Python output for real-time logs
      - PYTHONUNBUFFERED=1
      # Allow HTTP for OAuth redirect (localhost development)
      - OAUTHLIB_INSECURE_TRANSPORT=1
      # Override Windows paths with container paths
      - WATCH_FOLDER=/app/data/incoming
      - ARCHIVE_FOLDER=/app/data/archive
      - GMAIL_CREDENTIALS_FILE=/app/config/credentials.json
      - GMAIL_TOKEN_FILE=/app/config/token.json
    ports:
      # OAuth callback port (only needed for initial auth)
      - "8080:8080"
    volumes:
      - ./data:/app/data
      - ./config:/app/config  # Writable for token.json
    restart: unless-stopped
